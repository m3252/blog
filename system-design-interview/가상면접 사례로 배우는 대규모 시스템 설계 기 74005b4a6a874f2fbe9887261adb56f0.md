# 가상면접 사례로 배우는 대규모 시스템 설계 기초, 뉴스 피드 시스템 설계

# 뉴스 피드 시스템 설계

뉴스 피드란?

> “페이스북의 도움말 페이지는, 뉴스 피드는 여러분의 홈 페이지 중앙에 지속적으로 업데이트되는 스토리들로, 사용자 상태 정보 업데이트, 사진, 비디오, 링크, 앱 활동, 그리고 여러분이 페이스북에 팔로하는 사람들, 페이지, 또는 그룹으로부터 나오는 ‘좋아요’ 등을 포함한다” 고 설명한다.
> 

뉴스 피드는 아주 유명한 면접 문제이고 피드 시스템 종류로 페이스북, 트위터 타임라인, 인스타그램 피드 등이 있다.

## 1단계. 문제 이해 및 설계 범위 확정

**뉴스 피드 시스템을 설계하라고 했을 때 면접관의 의도를 질문을 통해 분명히 파악해야 한다. 최소한 어떤 기능을 지원해야 할지는 반드피 파악해야 한다.**

- 웹과 모바일에 대한 지원 필요
- 사용자는 뉴스 피드 페이지에 새로운 스토리를 올릴 수 있어야 하고 (**피드 발행**), 친구들이 올리는 스토리를 볼 수도 있어야 함 (**뉴스 피드 생성, 피드 읽기**)
- 뉴스 피드 정렬은 시간 흐름 역순으로 표시
- 한 명의 사용자는 최대 5,000명의 친구 목록을 가짐
- 하루 평균 천만 명 방문자
- 스토리에는 이미지나 비디오 등의 미디어 파일도 포함 가능

## 2단계. 개략적 설계안 제시 및 동의 구하기

설계안은 피드 발행(feed publishing)과 뉴스 피드 생성(news feed building)의 두 가지 부분으로 나눌 수 있다.

## **뉴스 피드 API**

- 클라이언트가 서버와 통신하기 위해 사용하는 수단
- HTTP 프로토콜 기반 (웹, 모바일 지원)
- 상태 정보를 업데이트, 뉴스 피드 가져오기, 친구 추가 등..

### 피드 발행

<aside>
💡 사용자가 스토리를 포스팅하면 해당 데이터를 캐시와 데이터베이스에 기록한다. 새 포스팅은 친구의 뉴스 피드에도 전송(뉴스 피드 생성)된다.

</aside>

```http request
### 피드 발행 API (새 스토리를 포스팅하기 위한 API)
POST /v1/me/feed
Content-Type: application/json
Authorization: ${인증 토큰}

{ 포스팅 내용 }
```

- 사용자 : 모바일 앱이나 브라우저에서 새 포스팅을 올리는 주체
    - `POST /v1/me/feed` API를 사용
- 로드밸런서 : 트래픽을 웹 서버들로 분산
- 웹 서버 : HTTP 요청을 내부 서비스로 중계하는 역할
- 포스팅 저장 서비스(post service) : 새 포스팅을 데이터베이스와 캐시에 저장
- 포스팅 전송 서비스(fanout service) : 새 포스팅을 친구의 뉴스피드에 푸시(push), 뉴스 피드 데이터는 캐시에 보관
- 알림 서비스 (notification service) : 친구들에게 새 포스팅을 알리거나, 푸시 알림을 보내는 역할

### 뉴스 피드 생성

<aside>
💡 지면 관계상 뉴스 피드는 모든 친구의 포스팅을 시간 흐름 역순으로 모아서 만든다고 가정한다.

</aside>

```http request
### 피드 읽기 API (뉴스 피드를 가져오는 API)
GET /v1/me/feed
Authorization: ${인증 토큰}
```

- 사용자 : 뉴스 피드를 읽는 주체
    - `GET /v1/me/feed` API를 사용
- 로드밸런서 : 트래픽을 웹 서버들로 분산
- 웹 서버 : 트래픽을 뉴스 피드 서비스로 보냄
- 뉴스 피드 서비스(news feed service) : 캐시에서 뉴스 피드를 가져옴
- 뉴스 피드 캐시(news feed cache) : 뉴스 피드를 렌더링할 때 필요한 피드 ID를 보관

## 3단계. 상세 설계

## 4단계. 마무리